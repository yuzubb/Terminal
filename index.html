<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Terminal</title>
    <style>
        /* CSS: サイトの見た目を設定します */
        body {
            background-color: #1a1a1a; /* 少し柔らかい黒 */
            color: #f0f0f0; /* 少し柔らかい白 */
            font-family: 'monospace', 'Courier New', Courier; /* ターミナルらしい等幅フォント */
            font-size: 16px;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        #terminal {
            width: 100%;
            height: 90vh; /* 画面の高さの90% */
            overflow-y: scroll; /* 内容が増えたらスクロールできるように */
            border: 1px solid #333;
            padding: 10px;
            box-sizing: border-box; /* paddingを含めてサイズ計算 */
        }

        .line {
            display: flex;
        }
        
        .prompt {
            color: #8f8; /* プロンプトの色を緑に */
            margin-right: 8px;
        }
        
        .input-area {
            display: flex;
            align-items: center;
        }

        #command-line {
            background-color: transparent; /* 背景を透明に */
            border: none; /* 枠線をなくす */
            color: #f0f0f0; /* 入力文字の色 */
            font-family: inherit; /* 親要素のフォントを継承 */
            font-size: inherit; /* 親要素のフォントサイズを継承 */
            outline: none; /* クリックしたときの枠線をなくす */
            width: 100%;
        }

        /* スクロールバーのスタイル（おまけ） */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: #555;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
    </style>
</head>
<body>

    <div id="terminal">
        <div>Welcome to My Terminal!</div>
        <div>Type 'help' to see available commands.</div>
        <br>
    </div>
    
    <div class="input-area">
        <span class="prompt">$</span>
        <input type="text" id="command-line" autofocus>
    </div>

    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <script>
        // JavaScript: サイトの動きを制御します
        const terminal = document.getElementById('terminal');
        const commandLine = document.getElementById('command-line');
        const startTime = Date.now();

        // Pythonインタプリタの初期化
        let pyodide;
        async function initializePyodide() {
            print("Loading Python environment... This might take a moment.");
            pyodide = await loadPyodide();
            print("Python environment loaded. Type 'help' to see available commands.");
            
            // requestsモジュールを事前にインストールしておく
            print("Installing 'requests' module...");
            await pyodide.loadPackage("requests");
            print("Done. You can now use `import requests` in python.");
        }
        initializePyodide();

        // メッセージを画面に表示する関数
        function print(message) {
            const newLine = document.createElement('div');
            newLine.innerHTML = message; // innerHTMLを使うとHTMLタグも解釈される
            terminal.appendChild(newLine);
            terminal.scrollTop = terminal.scrollHeight; // 自動で一番下までスクロール
        }

        // Enterキーが押されたときの処理
        commandLine.addEventListener('keydown', async function(event) {
            if (event.key === 'Enter') {
                const command = commandLine.value.trim();
                
                if (command) {
                    print(`<div class="line"><span class="prompt">$</span><div>${command}</div></div>`);
                }

                await handleCommand(command);

                commandLine.value = '';
            }
        });

        // コマンドを処理する関数 (asyncに変更)
        async function handleCommand(command) {
            const parts = command.split(' ');
            const mainCommand = parts[0].toLowerCase();
            const args = parts.slice(1);
            const fullCommand = command;

            switch (mainCommand) {
                case 'help':
                    print("Available commands:");
                    print("&nbsp;&nbsp;<b>about</b>    - Shows information about this site.");
                    print("&nbsp;&nbsp;<b>contact</b>  - Shows contact information.");
                    print("&nbsp;&nbsp;<b>clear</b>    - Clears the terminal screen.");
                    print("&nbsp;&nbsp;<b>date</b>     - Shows the current date and time.");
                    print("&nbsp;&nbsp;<b>ls</b>       - Lists files in the current directory.");
                    print("&nbsp;&nbsp;<b>pwd</b>      - Prints the working directory.");
                    print("&nbsp;&nbsp;<b>cat</b> [file] - Displays the content of a file. (e.g., 'cat readme.txt')");
                    print("&nbsp;&nbsp;<b>whoami</b>   - Shows the current user.");
                    print("&nbsp;&nbsp;<b>uptime</b>   - Shows how long the system has been running.");
                    print("&nbsp;&nbsp;<b>echo</b> [text] - Repeats the given text.");
                    print("&nbsp;&nbsp;<b>fortune</b>  - Displays a random quote or joke.");
                    print("&nbsp;&nbsp;<b>js</b> [code]    - Executes JavaScript code. (e.g., 'js 2 * 10')");
                    print("&nbsp;&nbsp;<b>python</b> [code]- Executes Python code. (e.g., 'python print(2 * 10)')");
                    print("<br>");
                    print("<b>Dangerous Commands (Simulated):</b>");
                    print("&nbsp;&nbsp;<b>rm -rf /</b>   - <b>(DANGER)</b> Simulates a system wipe.");
                    print("&nbsp;&nbsp;<b>sudo reboot</b>  - <b>(DANGER)</b> Simulates a system reboot.");
                    print("&nbsp;&nbsp;<b>dd</b>       - <b>(DANGER)</b> Simulates overwriting a disk.");
                    break;
                
                case 'about':
                    print("This is a simple terminal-style website created with HTML, CSS, and JavaScript.");
                    break;

                case 'contact':
                    print("You can find me on...<br>&nbsp;&nbsp;GitHub: my-github-account<br>&nbsp;&nbsp;Twitter: my-twitter-handle");
                    break;

                case 'clear':
                    terminal.innerHTML = "<div>Welcome to My Terminal!</div><div>Type 'help' to see available commands.</div><br>";
                    break;

                case 'date':
                    print(new Date().toString());
                    break;
                
                case 'ls':
                    print("README.md&nbsp;&nbsp;&nbsp;&nbsp;about.txt&nbsp;&nbsp;&nbsp;&nbsp;contact.txt&nbsp;&nbsp;&nbsp;&nbsp;index.html");
                    break;

                case 'pwd':
                    print("/home/guest");
                    break;
                    
                case 'cat':
                    const filename = args[0];
                    if (!filename) {
                        print("Usage: cat [filename]");
                        break;
                    }
                    const files = {
                        "readme.txt": "Welcome to my terminal! This is a fake file content. Use 'help' for more commands.",
                        "about.txt": "This terminal was built by a developer who loves the command line.",
                        "contact.txt": "Email: fake@example.com"
                    };
                    
                    if (files[filename]) {
                        print(files[filename]);
                    } else {
                        print(`cat: ${filename}: No such file or directory`);
                    }
                    break;

                case 'whoami':
                    print("guest");
                    break;

                case 'uptime':
                    const uptimeInSeconds = Math.floor((Date.now() - startTime) / 1000);
                    const hours = Math.floor(uptimeInSeconds / 3600);
                    const minutes = Math.floor((uptimeInSeconds % 3600) / 60);
                    const seconds = uptimeInSeconds % 60;
                    print(`up ${hours} hours, ${minutes} minutes, ${seconds} seconds`);
                    break;

                case 'echo':
                    if (args.length > 0) {
                        print(args.join(' '));
                    }
                    break;
                
                case 'fortune':
                    const fortunes = [
                        "The early bird gets the worm, but the second mouse gets the cheese.",
                        "A computer's ability to be a useful tool is proportional to its ability to be a fun toy.",
                        "You can't have everything. Where would you put it?",
                        "An optimist thinks this is the best of all possible worlds. A pessimist fears it is true.",
                        "Don't worry about the world ending today. It's already tomorrow in Australia."
                    ];
                    const randomIndex = Math.floor(Math.random() * fortunes.length);
                    print(fortunes[randomIndex]);
                    break;

                case 'js':
                    const jsCode = args.join(' ');
                    if (jsCode) {
                        try {
                            const result = eval(jsCode);
                            print(result);
                        } catch (e) {
                            print(`<span style="color: red;">Error: ${e.message}</span>`);
                        }
                    } else {
                        print("Usage: js [your JavaScript code]");
                    }
                    break;

                case 'python':
                    const pythonCode = args.join(' ');
                    if (pyodide) {
                        try {
                            // Pythonの出力を捕捉して表示
                            let output = "";
                            pyodide.setStdout({
                                isatty: true,
                                write: (buf) => {
                                    const str = new TextDecoder("utf-8").decode(buf);
                                    output += str;
                                },
                                flush: () => {
                                    print(output);
                                    output = "";
                                }
                            });
                            
                            const result = pyodide.runPython(pythonCode);
                            
                            if (result !== undefined) {
                                print(result);
                            }
                        } catch (e) {
                            print(`<span style="color: red;">Python Error: ${e}</span>`);
                        }
                    } else {
                        print("Python environment is still loading. Please wait...");
                    }
                    break;
                
                case 'rm':
                    if (args.join(' ') === '-rf /') {
                        print("<span style='color: red;'>Warning: This is a highly dangerous command!</span>");
                        print("Simulating system wipe...");
                        print("All files deleted. The system is now empty.");
                        print("<br>");
                        print("...Just kidding! Your terminal is safe.");
                    } else {
                        print("rm: cannot remove file: Is a directory (simulated)");
                    }
                    break;

                case 'sudo':
                    if (args[0] === 'reboot') {
                        print("Broadcast message from systemd-journald@host (Sun 2025-08-10 11:44:26 JST):");
                        print("<br>");
                        print("The system is going down for reboot NOW!");
                        print("<br>");
                        print("...System is back online. Welcome back.");
                    } else {
                        print("sudo: unknown command");
                    }
                    break;
                    
                case 'dd':
                    if (args.join(' ') === 'if=/dev/zero of=/dev/sda') {
                        print("<span style='color: red;'>DANGER!</span> This command will completely erase your hard drive.");
                        print("Simulating disk wipe...");
                        print("128+0 records in");
                        print("128+0 records out");
                        print("65536 bytes transferred in 0.000100 secs (655360000 bytes/sec)");
                        print("<br>");
                        print("...Your files are still here, don't worry.");
                    } else {
                        print("dd: missing operand after 'dd'");
                    }
                    break;

                default:
                    if(fullCommand) {
                        print(`Command not found: ${fullCommand}. Type 'help' for a list of commands.`);
                    }
                    break;
            }
        }
        
        // ページ上のどこかをクリックしたときに入力欄にフォーカスを当てる
        document.body.addEventListener('click', function() {
            commandLine.focus();
        });

    </script>
</body>
</html>
